var apiPath="/admin/api.php",months=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'],weekDays=['SUN','MON','TUE','WED','THU','FRI','SAT'],apiOtp='',otpLogin=false,emailRegex=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,mobileRegex=/[0-9 -()+]+$/,isMobile=false,mobileWidth=992,cartTotal=0,selectedProdutId='';var fbAppId='318025915691578',googleAppId='24366273261-5rv3b2fnl8i0hievrd9tm8gu605i5qd4.apps.googleusercontent.com',googlePlacesId='AIzaSyDoESeKHmdBr5S4k6OXPOLW5cKsXHV57o0';if(typeof(imageBaseUrl)=='undefined'){var imageBaseUrl='https://cdn.onlymeat.in/images/';}
var omHistory=window.localStorage.getItem("omHistory");if(omHistory!=null&&omHistory.length>0){omHistory=omHistory.split(',');if(omHistory[omHistory.length-1]!=window.location.href){omHistory.push(window.location.href);if(omHistory.length>10){omHistory.shift();}}}else{omHistory=[window.location.href];}
window.localStorage.setItem("omHistory",omHistory.toString());var user=window.localStorage.getItem("user");user=JSON.parse(user);if(!user){var googleUser={};var initGLogin=function(){gapi.load('auth2',function(){auth2=gapi.auth2.init({client_id:googleAppId,cookiepolicy:'single_host_origin',});attachSignin(document.getElementsByClassName('gplus btn')[0]);attachSignin(document.getElementsByClassName('gplus btn')[1]);});};function attachSignin(element){auth2.attachClickHandler(element,{},googleLogin,function(error){console.log(JSON.stringify(error,undefined,2));});}}else{if(!user.mobile||!mobileRegex.test(user.mobile)){openSideNav('mobileUpdateSideNav');}}
function isMobileDevice(){return(typeof window.orientation!=="undefined")||navigator.userAgent.match(/(iPhone|iPod|iPad|Android|webOS|BlackBerry|IEMobile|Opera Mini)/i);}
function getSource(){var p={};location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(s,k,v){p[k]=v});if(p["src"]!==undefined){return p["src"];}else{return isMobileDevice()?"mobile":"desktop";}}
(function(){if($(window).width()<=mobileWidth){isMobile=true;}
$('input').on('focus',function(){$('.formValidMsg').hide();})
getCartDetails();if(isMobile){$('.show-on-desktop').remove();$('#locationCon').on('click',openLocationModal);var origin_input=document.getElementById('mobileLocality');}else{$('.show-on-mobile').remove();origin_input=document.getElementById('locality');}
if(!user){window.fbAsyncInit=function(){FB.init({appId:fbAppId,cookie:true,xfbml:true,version:'v3.0'});FB.AppEvents.logPageView();FB.getLoginStatus(function(response){console.log('FB login response is',response);fbLoginCallback(response);});};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="https://connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));initGLogin();}
if(user){$('.signin, .profilePageIcon .signin').addClass('d-none').removeClass('d-flex');$('.profilePageIcon .profileLink').addClass('d-flex');}else{$('.profileMenu, .profilePageIcon .profileLink').addClass('d-none').removeClass('d-flex');$('.profilePageIcon .signin').addClass('d-flex').removeClass('d-none');}
var locality=window.localStorage.getItem("locality");if(locality){$('.locationText').text(locality);}
$('.custSideNav').on('click',function(e){var tabId=this.dataset.id;if(tabId){openSideNav(tabId);}
e.stopPropagation();});$('.closeSideNav, .bgOverlay').on('click',function(e){if(user&&(!user.mobile||!mobileRegex.test(user.mobile))){return;}
$('.custSideNavContent, .bottomModal').removeClass('open')
$('.bgOverlay').fadeOut();$('body').removeClass('overflow-h');$('#createAccount').hide();$('#loginScreen').show();e.stopPropagation();});$('.closeLocation').on('click',function(e){$('#locationModal').removeClass('open');});$('.closemobileUpdateSideNav').on('click',function(e){if(user&&(!user.mobile||!mobileRegex.test(user.mobile))){return;}
closeSideNav('mobileUpdateSideNav');});$('.createNew, .backToLogin').on('click',function(){$('#createAccount, #loginScreen').toggle();});$('.loginRequestOtp2').on('click',function(){$('.pwdBlock, .otpBlock').toggleClass('d-none');$(this).find('.otp').toggleClass('d-none')
$(this).find('.pwd').toggleClass('d-none')});function initMap(){var autocomplete=new google.maps.places.Autocomplete(origin_input);autocomplete.setComponentRestrictions({'country':['in']});var geolocation={lat:17.4126274,lng:78.2679571};var circle=new google.maps.Circle({center:geolocation,radius:50000});autocomplete.setBounds(circle.getBounds());autocomplete.setOptions({strictBounds:true})
autocomplete.addListener('place_changed',function(){var place=autocomplete.getPlace();$('#loc_latlong').val(place.geometry.location);origin_place_id=place.place_id;var tempOrderId=window.localStorage.getItem("tempOrderId");var locality=isMobile?$("#mobileLocality").val():$("#locality").val();if(locality){window.localStorage.setItem("locality",locality);$('.locationText').text(locality);}
showLoader();var data="locality="+locality+"&loc_latlong="+$("#loc_latlong").val()+"&spoc="+$("#spoc").val()+"";if(tempOrderId&&tempOrderId!=='undefined'){data+="&temp_order_id="+(tempOrderId||'');}
$.ajax({type:"GET",url:apiPath+"?spoc_location=1&"+data,success:locationUpdated,failure:function failerr(err){console.log('Error',err);hideLoader();}});function locationUpdated(responce){hideLoader();if(responce.spoc_id=="na"){window.localStorage.setItem("locality",'');$('.locationText').text('--');$('#locality, #mobileLocality').val('');var msg="Dear customer, we are sorry that the locality you selected is out of our Delivery range. Please call the customer care at 040- 40 39 38 37 for further assistance";if(isMobile){$('.invalid-location').text(msg).show();}else{showCustomAlert(msg,true);}}else{console.log(responce);window.localStorage.setItem("tempOrderId",responce.temp_order_id);window.localStorage.setItem("spocId",responce.spoc_id);window.localStorage.setItem("loc_latlong",responce.loc_latlong);document.getElementById("spoc").value=responce;$('#closeLocation, .closeLocation, .bgOverlay').trigger('click');$('.bottomModal').removeClass('open');$('.invalid-location').hide();hideCustomAlert();if(selectedProdutId){addToCart(selectedProdutId,isBuyNow);}}}});}
initMap();$('.locationCon, #addressLocationCon').on('click',function(){if(!isMobile){$('#locality, #mobileLocality').val('');$('.searchLocation').addClass('open');$('.searchBgOverlay').fadeIn();$('html, body').animate({scrollTop:0});}else{openLocationModal();}})
$('.searchBgOverlay, #closeLocation').on('click',function(e){$('.searchLocation').removeClass('open');$('.searchBgOverlay').fadeOut();e.stopPropagation();});$('#mobNumber3, #mobNumber2, #mobNumber1').on('input',function(){var text=$(this).val().trim();if(!isNaN(text)&&text.length==10){$('.loginRequestOtp').fadeIn();$('.loginWithPwd').hide();}else{$('.loginRequestOtp').hide();$('.loginWithPwd').hide()
$('#loginPwd1, #loginPwd2, #loginPwd3').removeClass('d-none');$('#loginOtp1, #loginOtp2, #loginOtp3').addClass('d-none');}});$('.loginProceed').on('click',function(e){e.preventDefault();var mobile=$('[name=loginMobile]').val().trim();if(otpLogin){var password=$('[name=loginOTP]').val().trim();}else{var password=$('[name=loginPassword]').val().trim();}
validateLogin(mobile,password);});$('.signUpBtn').on('click',function(){var mobile=$('#spMobNumber').val().trim();var password=$('#spLoginPwd').val().trim();var confirmPwd=$('#spLoginConfPwd').val().trim();var email=$('#spEmail').val().trim();var firstName=$('#spFirstName').val().trim();var lastName=$('#spLastName').val().trim();validateSignup(mobile,password,confirmPwd,email,firstName,lastName);});})($);function openSideNav(tabId){$('#loginSideNav').removeClass('open');$('.bgOverlay').fadeIn();$('#'+tabId).addClass('open');$('body').addClass('overflow-h');}
function closeSideNav(tabId){$('.bgOverlay').fadeOut();$('#'+tabId).removeClass('open');$('body').removeClass('overflow-h');}
function closeModal(modalSelector){$(modalSelector).modal('hide');}
function openLocationModal(){$('#loginSideNav').removeClass('open');$('.bgOverlay').fadeOut();$('body').removeClass('overflow-h');$('#locationModal').addClass('open');$('#locality, #mobileLocality').val('');}
function changeToPassword(id){otpLogin=false;$('#loginPwd3, #loginOtp3').toggleClass('d-none');$('.loginWithPwd').hide();$('.loginRequestOtp').fadeIn();}
function requestOTP(name){var mobile=$('[name='+name+']').val().trim();var otpSelector='#loginPwd1, #loginOtp1, #loginPwd2, #loginOtp2, #loginPwd3, #loginOtp3';if(name=='fbMobile'){otpSelector='#fbMobOtp';}
$('.formValidMsg').hide();if(mobile.length===0){$('.login-mob-err').text('Mobile number cannot be empty').fadeIn();return;}
if(mobileRegex.test(mobile)){if(mobile.length<10){$('.login-mob-err').text('Please enter a valid Mobile number').fadeIn();return;}
if(mobile.length===10){otpLogin=true;showLoader();$(otpSelector).toggleClass('d-none');$('.loginWithPwd').fadeIn();$('.loginRequestOtp, .fbRequestOtp').hide();var data={login_otp:1,mobile:mobile};$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){hideLoader();if(resp.result=='success'){$('.login-otp-err').text('Please enter OTP received on your mobile').fadeIn();}else{console.log('Send OTP response is ',resp);$('.login-otp-err').text(resp.message).fadeIn();}},error:function(resp){console.log('Login failed',resp);hideLoader();$('.login-otp-err').text('OTP request failed. Please try again.').fadeIn();}});}}else{$('.login-mob-err').text('Please enter a valid Mobile number').fadeIn();}}
function forgotPassword(name){var mobile=$('[name='+name+']').val().trim();$('.formValidMsg').hide();if(mobile.length===0){$('.login-mob-err').text('Mobile number cannot be empty').fadeIn();return;}
if(mobileRegex.test(mobile)){if(mobile.length<10){$('.login-mob-err').text('Please enter a valid Mobile number').fadeIn();return;}
if(mobile.length===10){showLoader();var data={forgotpassword:1,mobile:mobile};$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('Forgot Password response is ',resp);hideLoader();$('.login-pwd-err').text(resp.message).fadeIn();},error:function(resp){console.log('Login failed',resp);hideLoader();$('.login-pwd-err').text(resp.message||'Forgot password request failed').fadeIn();}});}}else{$('.login-mob-err').text('Please enter a valid Mobile number').fadeIn();}}
function buyNow(){window.location.href="/checkout";}
function getCartDetails(){var tempOrderId=window.localStorage.getItem("tempOrderId");if(tempOrderId!=''&&tempOrderId!=null&&tempOrderId!='undefined'){$.ajax({type:"GET",url:apiPath+"?cartdetails=1&temp_order_id="+tempOrderId,success:function(response){if(response.result=='success'){cartTotal=0;if(response.productlist&&response.productlist.length>0){var cartCount=response.productlist.length;$('.cart-number').text(cartCount).addClass('cartCount');for(var i=0;i<cartCount;i++){var product=response.productlist[i];cartTotal+=product.p_cost;}
if(typeof(showCartAlert)!='undefined'){var cartText=cartCount+' item'+(cartCount==1?'':'s');$('.cart-text').text(cartText);showCartAlert();}}else{handleEmptyCart();}}else{handleEmptyCart();}},error:function(response){console.log('Error occurred',response);}});}}
function handleEmptyCart(){$('.cart-number').text('').removeClass('cartCount');$('.billInfo').hide();$('.cart-items').html('<div class="text-center p-5">No Items in your Cart</div>');}
function validateLogin(mobile,password){$('.formValidMsg').hide();if(mobile.length===0){$('.login-mob-err').text('Email/Mobile number cannot be empty').fadeIn();return;}
if(mobileRegex.test(mobile)){if(mobile.length<10){$('.login-mob-err').text('Please enter a valid Mobile number').fadeIn();return;}
if(mobile.length===10){if(otpLogin){if(password.length===0){$('.login-pwd-err').text('OTP cannot be empty').fadeIn();return;}}else{if(password.length===0){$('.login-pwd-err').text('Password cannot be empty').fadeIn();return;}}}}else{if(password.length===0){$('.login-pwd-err').text('Password cannot be empty').fadeIn();return;}
if(!emailRegex.test(mobile)||mobile==''){$('.login-mob-err').text('Please enter a valid email address.').fadeIn();return;}}
loginUser(mobile,password);}
function loginUser(mob,pwd){var data={mobile:mob};if(otpLogin){data.login_with_otp_data=1;data.otp=pwd;}else{data.login=1;data.password=pwd;}
showLoader();$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('Login response is ',resp);hideLoader();if(resp.result==='success'){postUserLogin(resp);}else{$('.login-pwd-err').text(resp.message||'Invalid details. Please try again.').fadeIn();}},error:function(resp){console.log('Login failed',resp);hideLoader();}});}
function postUserLogin(resp){delete resp.message;delete resp.incoming;delete resp.result;user=resp;window.localStorage.setItem("user",JSON.stringify(user));$('#deliveryCollapse').collapse('show');$('.closeSideNav').trigger('click');$('.signin').addClass('d-none').removeClass('d-flex');$('.profileMenu, .profilePageIcon .profileLink').addClass('d-flex');if($(window).width()<=mobileWidth){$('.orderLogin').toggle();$('.deliveryCard').toggleClass('active');}
if(typeof(getUserAddresses)!='undefined'){getUserAddresses();}
if(typeof(getAvailedOffers)!='undefined'){getAvailedOffers();}}
function validateSignup(mobile,password,confirmPwd,email,firstName,lastName){$('.formValidMsg').hide();if(firstName.length==0){$('.cr-fname-err').text('First Name cannot be empty').fadeIn()
return;}
if(lastName.length==0){$('.cr-lname-err').text('Last Name cannot be empty').fadeIn()
return;}
if(email.length>0&&!emailRegex.test(email)){$('.cr-email-err').text('Please enter a valid email address.').fadeIn();return;}
if(mobile.length===0){$('.cr-mob-err').text('Mobile number cannot be empty').fadeIn()
return;}
if(mobile.length<10){$('.cr-mob-err').text('Please enter a valid Mobile number').fadeIn()
return;}
if(mobile.length===10){if(password.length===0){$('.cr-pwd-err').text('Password cannot be empty').fadeIn()
return;}
if(password.length<6){$('.cr-pwd-err').text('Password should be minimum 6 characters').fadeIn()
return;}
if(password!==confirmPwd){$('.cr-cpwd-err').text('Passwords do not match').fadeIn()
return;}
signup(mobile,password,email,firstName,lastName);}else{$('.cr-mob-err').text('Mobile number should be 10 digits').fadeIn()}}
function signup(mobile,password,email,firstName,lastName){var data={register_customer:1,mobile:mobile,password:password,email:email,first_name:firstName,last_name:lastName};showLoader();$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('Registration response is ',resp);hideLoader();if(resp.result==='success'){user=resp;$('.createAccount').hide();$('.otpScreen').show().find('input').focus();$('.cr-otp-err').text('Please enter the OTP to verify your account.').fadeIn();}else{$('.cr-cpwd-err').text(resp.message).fadeIn();}},error:function(resp){console.log('User registration failed',resp);hideLoader();}});}
function activateAccount(name){var otp=$('[name='+name+']').val().trim();if(otp.length===0){$('.cr-otp-err').text('OTP cannot be empty').fadeIn();return;}
if(otp.length!=6){$('.cr-otp-err').text('Please Enter a valid OTP.').fadeIn();return;}
showLoader();var data={activate_account:1,mobile:user.mobile,otp:otp};$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('OTP response is ',resp);if(resp.result==='success'){postUserLogin(resp);}else{$('.cr-otp-err').text('Invalid OTP. Please try again.').fadeIn();}
hideLoader();},error:function(resp){console.log('OTP validation failed',resp);$('.cr-otp-err').text('Invalid OTP. Please try again.').fadeIn();hideLoader();}});}
function logout(){window.localStorage.removeItem("user");window.location.reload();}
function goto(link){window.location.href=link;}
function goBack(){if(typeof(pageType)!='undefined'&&pageType=='product'){goto('/');return;}
if(typeof(omHistory)=='undefined'){window.history.back();return;}
console.log(omHistory);if(omHistory&&omHistory.length>0){while(omHistory.length>0){var loc=omHistory.pop();if(loc!=window.location.href){window.localStorage.setItem("omHistory",omHistory);window.location.href=loc;break;}}
if(omHistory.length==0){window.localStorage.setItem("omHistory",omHistory);goto('/');}}}
function searchClicked(){var query='';if($(window).width()<mobileWidth){if(window.location.pathname=="/"){query=$('.mob-home-search').val();}else{query=$('.mob-search').val();}}else{query=$('.desk-search').val();}
if(query.length>0){goto('/search?query='+query);}}
function fbLoginCallback(response){}
function fbLogin(){FB.login(function(response){console.log(response);showLoader();FB.api("/me",{fields:"first_name,last_name,email,name,id"},function(e){console.log(e);if(e&&!e.error){var data="username="+e.email+"&name="+e.name+"&app_id="+e.id+"&provider=fb&fb_login=1";$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('FB OM Login response is ',resp);hideLoader();if(resp.result==='success'){if(!resp.mobile||!mobileRegex.test(resp.mobile)){user=resp;openSideNav('mobileUpdateSideNav');}else{postUserLogin(resp);}}else{showCustomAlert(resp.message,true);}},error:function(resp){console.log('FB OM connection failed',resp);hideLoader();}});}else{hideLoader();}});},{scope:'public_profile,email'});}
function googleLogin(googleUser){showLoader();var email=googleUser.getBasicProfile().getEmail();var name=googleUser.getBasicProfile().getName();var id=googleUser.getBasicProfile().getId();var data="username="+email+"&name="+name+"&app_id="+id+"&provider=google&fb_login=1";$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('Google OM Login response is ',resp);hideLoader();if(resp.result==='success'){if(!resp.mobile||!mobileRegex.test(resp.mobile)){user=resp;openSideNav('mobileUpdateSideNav');}else{postUserLogin(resp);}}else{console.log(resp.message);}},error:function(resp){console.log('Google OM connection failed',resp);hideLoader();}});}
function requestProfileOtp(selector){$(this).hide();var username=user.email||user.mobile;var newMobile=$(selector).val().trim();$('.formValidMsg').hide();if(newMobile.length===0){$('.per-mob-err').text('Mobile number cannot be empty').fadeIn();return;}
var intRegex=/[0-9 -()+]+$/;if(intRegex.test(newMobile)){if(newMobile.length<10){$('.per-mob-err').text('Please enter a valid Mobile number').fadeIn();return;}
if(newMobile.length===10){showLoader();var data={profileeditotp:1,username:username,new_mobile_number:newMobile};$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){hideLoader();if(resp.result=='success'){$('#fbMobOtp, .btnUpdateMobile').removeClass('d-none');$('.fbRequestOtp').addClass('d-none');$('.per-otp-err').text('Please enter OTP received on your mobile').fadeIn();}else{console.log('Send OTP response is ',resp);$('.per-otp-err').text(resp.message).fadeIn();}},error:function(resp){console.log('Login failed',resp);hideLoader();$('.per-otp-err').text('OTP request failed. Please try again.').fadeIn();}});}}else{$('.per-mob-err').text('Please enter a valid Mobile number').fadeIn();}}
function updateUserMobile(){var username=user.email||user.mobile;var first_name=user.name,last_name='',newEmail=user.email,formOtp=$('#fbMobOtp').val().trim(),newMobile=$('#fbMobileNo').val().trim();$('.formValidMsg').fadeOut();if(newMobile.length==0){$('.per-mob-err').text('Mobile cannot be empty').fadeIn();return;}
var intRegex=/[0-9 -()+]+$/;if(intRegex.test(newMobile)){if(newMobile.length!==10){$('.per-mob-err').text('Please Enter a valid Mobile number').fadeIn();return;}}
if(!formOtp||formOtp.length<6){$('.per-otp-err').text('Please enter a valid OTP').fadeIn();return;}
showLoader();var data={updateprofile:1,username:username,mobile:newMobile,new_mobile:newMobile,email:newEmail,first_name:first_name,last_name:last_name,otp:formOtp};$.ajax({type:"POST",url:apiPath,data:data,success:function(resp){console.log('Profile update response is ',resp);if(resp.result==='success'){closeSideNav('mobileUpdateSideNav');postUserLogin(resp);}else{$('.per-otp-err').text(resp.message).fadeIn();}
hideLoader();},error:function(resp){console.log('Profile updation failed',resp);hideLoader();}});}
function showCustomAlert(text,error){if(error){$('.alertModal').addClass('error');}else{$('.alertModal').removeClass('error');}
$('.alert-message').text(text||'');$('.alertModal').addClass('open');}
function hideCustomAlert(){$('.alertModal').removeClass('open');}
function showLoader(){$('.pageLoader').addClass('open');}
function hideLoader(){$('.pageLoader').removeClass('open');}